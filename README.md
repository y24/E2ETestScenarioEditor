# E2E Test Scenario Editor

E2Eテストシナリオ(JSON形式)を視覚的に編集するためのWebベースのエディタです。

## 概要

このツールは、E2Eテストフレームワークで使用するJSONシナリオファイルを、ブラウザ上で直感的に編集できるようにします。複雑なJSON構造を意識することなく、ドラッグ&ドロップやプロパティパネルを通じて効率的にテストケースを作成・管理できます。

### 主な機能

- **ファイルブラウザ**: シナリオディレクトリ内のファイルをツリー表示。ディレクトリをクリックしてパスを素早く切り替え可能。
- **タブ管理**: 複数のシナリオファイルを同時に開き、タブで切り替えて編集。
- **高度な編集機能**:
    - **ドラッグ&ドロップ**: ステップの並び替え、グループ間移動、セクション間移動が直感的に可能。
    - **複数ステップ選択**: チェックボックスまたは Shift+クリックで範囲選択。
    - **一括操作**: 選択したステップをまとめて無効化/有効化、削除、コピー、グループ化。
    - **グループ化**: 関連するステップをグループとしてまとめ、名前を付けて管理可能。グループ単位での折り畳みにも対応。
- **セクション管理**: Setup / Steps / Teardown の各セクションを個別に管理。見出しをクリックして表示を折り畳むことが可能。
- **プロパティエディタ**: ステップの詳細設定を右パネルで編集。JSONの構造を保ったままキーや値を変更。
- **JSON構造保持**: プロジェクト固有の未知のキーや構造を破壊せずに読み込み・保存。
- **レスポンシブレイアウト**: パネルのリサイズが可能で、作業環境に合わせたレイアウト調整が可能。

## 技術スタック

- **Backend**: FastAPI + Uvicorn (Python 3.10+)
- **Frontend**: Vanilla JavaScript (ES6+), HTML5, CSS3
- **ライブラリ**: SortableJS (ドラッグ&ドロップ), Ionicons (アイコン)

## 必要な環境

- Python 3.10 以上
- pip (Pythonパッケージマネージャー)
- モダンなWebブラウザ (Chrome, Edge など)

## セットアップと起動手順

### 1. 依存関係のインストール

プロジェクトのルートディレクトリで以下のコマンドを実行します:

```powershell
pip install -r requirements.txt
```

### 2. サーバーの起動

Windows環境では、同梱の `run.bat` を使用するのが最も簡単です。

#### 方法A: run.bat で起動 (推奨)

プロジェクトルートにある `run.bat` をダブルクリックして実行します。
- 自動的に文字コード設定 (UTF-8) が行われます。
- サーバーが起動し、標準のブラウザで `http://127.0.0.1:8000` が自動的に開かれます。

#### 方法B: 手動で起動

コマンドプロンプトや PowerShell で以下を実行します:

```powershell
uvicorn src.backend.main:app --host 127.0.0.1 --port 8000
```

### 3. 初回設定

初回起動時（または設定未完了時）には設定内容の確認・変更ダイアログが表示されます:

1. **Scenario Directories**: シナリオファイルが格納されているディレクトリを登録します。複数のディレクトリを登録して切り替えて使用することが可能です。
2. **Page Object Folder** (オプション): Page Object (Pythonファイル等) が格納されているディレクトリパスを指定します。指定すると、ステップの Target 設定時に候補として表示されます。

設定は `config.json` に保存されます。左上の設定アイコンからいつでも変更可能です。

## 使い方

### ファイルの操作
- **開く**: 左パネルのファイルブラウザからJSONファイルを選択。
- **新規作成**: ツールバーの「New File」をクリック。保存時にファイル名を指定します。初期値としてIDが提案されます。
- **保存**: ツールバーの「Save」または `Ctrl+S`。

### ステップの編集
- **選択**: ステップをクリックすると右パネルに詳細が表示されます。
- **並び替え**: 左側のグリップアイコンをドラッグして移動。
- **複製/削除**: ステップ右側のアイコンから操作。
- **一括操作**: 左側のチェックボックスで複数選択すると、画面下部に操作バーが出現します。

### グループ化
- 複数のステップを選択し、下部操作バーの「Group」をクリックするとグループ化されます。
- グループ名はダブルクリックで変更可能です。
- グループを解除するには、グループヘッダーの「アイコン（Ungroup）」をクリックします。

## ディレクトリ構成

```
E2ETestScenarioEditor/
├── src/
│   ├── backend/           # FastAPIバックエンド
│   │   ├── main.py        # エントリーポイント
│   │   ├── api.py         # APIエンドポイント
│   │   ├── file_service.py # ファイル操作ロジック
│   │   └── config.py      # 設定管理
│   └── static/            # フロントエンドアセット
│       ├── index.html     # メインHTML
│       ├── css/           # スタイルシート
│       └── js/            # JavaScriptモジュール (ui/ フォルダに各パーツのロジックを分離)
├── docs/                  # プロジェクト詳細資料
├── config.json            # アプリケーション設定
├── requirements.txt       # Python依存関係
├── run.bat                # Windows用起動スクリプト
└── README.md              # このファイル
```

## トラブルシューティング

### サーバーが起動しない
- `python --version` で 3.10 以上であることを確認してください。
- `pip install -r requirements.txt` が完了しているか確認してください。

### 保存できない
- 指定したディレクトリへの書き込み権限を確認してください。
- ブラウザのデベロッパーツール (F12) のコンソールにエラーが出ていないか確認してください。
